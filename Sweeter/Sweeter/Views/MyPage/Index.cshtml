@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using Sweeter.Models;
@model IEnumerable<PostsModel>;

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/lib/src/style_@ViewData["Style"] .css">
    <link rel="icon" type="image/png" href="~/lib/img/logo.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        $(window).scroll(function () {
            if ($(window).scrollTop() > 300) {
                $('#scrollToTop').show();
            }
            else {
                $('#scrollToTop').hide();
            }
        })
        var timeOut;
        function scrollToTop() {
            var position = document.body.scrollTop || document.documentElement.scrollTop;
            if (position) {
                window.scrollBy(0, -Math.max(10, Math.floor(position / 10)));
                scrollAnimation = setTimeout('scrollToTop()', 10);
            }
            else clearTimeout(scrollAnimation);
        }
    </script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="~/js/site.js"></script>
    <link rel="shortcut icon" href="~/lib/img/logo.png" type="image/png">
    <title>My Page</title>
</head>
<body>
    <div class="row">
        <!--Avatar + logo-->
        <div class="col-md-2 col-xs-0 col-lg-2 col-sm-2 leftside">
            <div class="logoleftt " style="text-align:center">
                <h1 class="headlabel " style="font-size:35px; margin-top:-2%;">JAY</h1>
                <img src="~/lib/img/_@ViewData["Style"]/logo.png" class="logoleft ">
            </div>
            <hr class="line ">
            <img src=@ViewData["Pic"] class="avatar">
            <hr class="line ">
            <div class="col-md-2 col-xs-0 col-lg-2 col-sm-2 leftside">
                <button class="navi" onclick="location.href='@Url.Action("Index","Profile")' ">Edit</button>
                <button id="scrollToTop" class="navi" title="Back to Top" href="#" onclick="scrollToTop();return false" hidden>Back to Top &uarr;</button> <!--butoon to scroll up-->
            </div>
        </div>
            <!--Same mobile-->
        <div class="col-md-8 col-xs-12 col-lg-8 col-sm-8 maincontainer">
            <div class="headmobile">
                <div class="row">
                    <div class="col-md-0 col-xs-4 col-lg-0 col-sm-0 ">
                        <img src="~/lib/img/_@ViewData["Style"]/logo.png" class="mobilelogoleft">
                    </div>
                    <div class="col-md-0 col-xs-4 col-lg-0 col-sm-0 ">
                        <h1 class="mobileheadlabel">JAY</h1>
                    </div>
                    <div class="col-md-0 col-xs-4 col-lg-0 col-sm-0 " style="text-align:center;">
                        <img src=@ViewData["Pic"] class="mobileavatar">
                    </div>
                </div>
            </div>
            <!--Add Post Mobile-->
            <div class="addfeedmobile" id="Addfeed">
                <form action="MyPage/addfeed" method="post" class="addfeedformmobile">
                    <textarea class="mobilemypost" name="mypost" id="mypost" rows="2" placeholder="What are you thinking about..."></textarea>
                    <button type="button" class=" btn mobileaddpost" data-toggle="modal" data-target="#myMobileModal" name="addpost" id="addpost">Send</button>                    <hr style="border-color:rgba(0,0,0,0.6)">

                    <div class="mobilesignout">
                        <button type="button" class="mobilenavbutton" onclick="location.href='@Url.Action("Logout","LogOut")'">Sign out</button>
                    </div>
                    <div class="mobilemypage">
                        <button type="button" class="mobilenavbutton" onclick="location.href='@Url.Action("Index","MyPage")'">My Page</button>
                    </div>
                    <div class="mobilefeeds">
                        <button type="button" class="mobilenavbutton" onclick="location.href='@Url.Action("Index","Posts")'">Feeds</button>
                    </div>
                    <div class="modal " style="margin-top:18%;" data-backdrop="false" id="myMobileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content" style="margin-bottom:2%;">
                                <div class="modal-header">
                                    <h4 class="modal-title" id="exampleModalLongTitle">Choose the category</h4>
                                    <h4 class="modal-title" id="exampleModalLongTitle">If you choose nothing, "flood" would be chosen</h4>
                                </div>
                                <div class="modal-body" style="text-align:center;">
                                    <select size="13" name="category" id="Style" class="select">
                                        @foreach (CategoriesModel cats in (List<CategoriesModel>)ViewData["categories"])
                                {
                                    <option style="font-size:16px;" value="@cats.Category"> @cats.Category</option>
                        }
                                    </select>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <input type="submit" class="btn btn-primary" value="Send post">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="addfeedmobile hidebutton" id="HideForm">
                <p>Hide addpost form</p>
            </div>
            <div class="addfeedmobile hidebutton hidden" id="ShowForm">
                <p>Show addpost form</p>
            </div>
            <!--Info-->

            <div id="top"></div><!--Mark where to go to top-->

            <form action="" method="get" class="myInfoForm">
                <label class="lab" style="margin:1%">@ViewData["UserName"]</label>
                <hr>
                <div class="MyInfo" style="width:94%">
                    <h1 class="headinfo">My name is @ViewData["Name"]</h1>
                    <h1 class="headinfo"><b>Something about me:</b> @ViewData["About"]</h1>
                </div>
                <input type="button" class="editProfile editMobProfile" onclick="location.href='@Url.Action("Index","Profile")'" value="Edit">
            </form>
            <!--Add Post -->
            <form action="MyPage/addfeed" method="post" class="addfeedform">
                <label class="lab" style="margin:1%">Publish your post, @ViewData["UserName"]</label>
                <hr>
                <textarea class="mypost" name="mypost" id="mypost" rows="2" placeholder="What are you thinking about..."></textarea>
                <button type="button" class="btn addpost" name="addpost" id="addpost" data-toggle="modal" data-target="#myModal">Add post</button>
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" id="exampleModalLongTitle">Choose the category</h4>
                                <h4 class="modal-title" id="exampleModalLongTitle">If you choose nothing, "flood" would be chosen</h4>

                            </div>
                            <div class="modal-body" style="text-align:center;">

                                <select size="13" name="category" id="Style" class="select">
                                    @foreach (CategoriesModel cats in (List<CategoriesModel>)ViewData["categories"])
                            {
                                <option value="@cats.Category">  @cats.Category</option>
                    }
                                </select>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <input type="submit" class="btn btn-primary" value="Send post">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <hr class="line" style="margin-top:1.5%;margin-bottom:1.5%">
            <div id="wall">
                @foreach (PostsModel post in Model)
    {
            <form id="post_@post.IDpost">
                <label class="lab auser" style="margin:1%" onclick="location.href='@Url.Action("GetUser","User", new { idUs=post.IDuser})' ">
                    @post.Author.Username
                </label>
                <label class="lab auser componly" style="margin:1%" onclick="location.href='@Url.Action("Index","Posts",new { CatID=post.IDCategory})'">| @post.Category.Category | </label>
                <label class="lab auser componly" style="margin:1%">@post.PublicDate</label>

                @if (post.Author.Username.Equals(ViewData["UserName"]))
    {
            <button type="button" class="DeleteButton" data-id="@post.IDpost">X</button>
}
                <hr id="post_@post.IDpost">
                <div class="postcontainer">
                    <label class="postlabel">
                        @post.Text
                    </label>
                </div>
                <div class="telonly"><label class="telonly" onclick="location.href='@Url.Action("Index","Posts",new { CatID=post.IDCategory})'">|@post.Category.Category|</label> </div>
                <div class="cont">
                    <span><img src="lib/img/_@ViewData["Style"]/Like.png" class="like" data-id="@post.IDpost"></span>
                    <div class="likecontainer">
                        <label class="likelabel" id="@post.IDpost">
                            @post.LikeNumder
                        </label>
                    </div>
                    <span><img src="~/lib/img/_@ViewData["Style"]/comment.png" onclick="location.href='@Url.Action("Comments","Comment", new { id=post.IDpost})' " class="comment" /></span>
                    <div class="commentcontainer">
                        <label class="commentlabel">
                            @post.CommentNumber
                        </label>
                    </div>
                </div>
            </form>
}
                <script>
                    $(document).ready(function () {
                        $(".like").bind("click", function () {
                            var link = $(this);
                            var id = link.data('id');
                            $.ajax({
                                url: "@Url.Action("LikesToPosts","Like")",
                                type: "POST",
                                data: { id: id },
                                dataType: "text",
                                success: function (result) {

                                    $('#'+id).html(result);

                                }
                            });
                        });
                    });
                </script>
                <script>
                $(document).ready(function () {
                    $(".DeleteButton").bind("click", function () {
                        var link = $(this);
                        var id = link.data('id');
                        $.ajax({
                            url: "@Url.Action("DeletePost", "MyPage")",
                            type: "POST",
                            data: { id: id },
                            dataType: "text",
                            success: function (result) {

                                $("#post_" + id).html('<p text-align="center"><label>Post is deleted</label></p>');

                            }
                        });
                    });
                });
                </script>
            </div>
        </div>
            <!--Menu-->
            <div class="col-md-2 col-xs-0 col-lg-2 col-sm-2 rightside">
                <nav>
                    <button class="navi" onclick="location.href='@Url.Action("Index","MyPage")' ">My Page</button>
                    <button class="navi" onclick="location.href='@Url.Action("Index","Posts")' ">Feeds</button>
                    <button class="navi" onclick="location.href='@Url.Action("Logout","LogOut")' ">Log Out</button>
                </nav>
                <hr class="line">
            </div>
        </div>
</body>
</html>